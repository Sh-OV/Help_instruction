# ИНСТРУКЦИЯ по работе с LINUX

## Урок 1. Основы Linux

### Системные вызовы в Linux
1. Управление процессами:
    - fork() – создание нового процесса клонированием
    - exec() – запуск программы
    - exit() – завершение программы
2. Управление файлами:
    - open() – открыть файл
    - read() – прочитать данные из файла
    - write() – записать данные в файл
    - close() – закрыть файл

### Установка пакетов в Ubuntu
- sudo apt update – обновить список пакетов
- sudo apt install mc – установить пакет mc
- sudo apt install openssh-server – установить SSH-сервер

### Сетевые режимы VirtualBox
- Мост (bridge) – ВМ в локальной сети, прямой доступ к ВМ по IP.
- NAT – ВМ в своей сети, доступ к машине только через проброс портов.
        При пробросе портов (создаем порт, протокол - TCP, Порт хоста - 8022, Порт гостя - 22)

### Установка гостевых дополнений VB в Ubuntu
- sudo apt update – обновить список пакетов
- sudo apt install perl gcc make – установить пакеты
- Запуск установки гостевых дополнений

### Команды для подключения сети:
- ip a      - покажет список сетевых интерфейсов
- systemctl status ssh          - проверяем статус сервисов (подключения)
- ssh olga@192.168.0.108        - подключение (по мосту (bridge) к удаленному   пользователю, в нашем случае к Windows PowerShell)
- ssh -p 8022 olga@localhost    - подключение NAT (при беспроводном интернете) с помощью проброса портов

## Урок 2. Работа с файлами в терминале

### Что такое оболочка
Пользователь    ->  Оболочка (Bash) ->  Операционная система
Оболочка - посредник (переводчик) между пользователем и операционной системой

### Приглашение оболочки Bash
Пример записи:  olga@olga-VirtualBox-linux:~$
Расшифровка:    "имя пользователя(логин)"(olga) @ "имя компьютера(хоста)"(olga-VirtualBox-linux) : "текущий каталог"(~ (домашний католог)) "тип пользователя"($ (обычный пользователь))
    $   - обычный пользователь
    #   - суперпользователь с правами root
Чтобы подключиться с правами суперпользователя вводим команду
    :~$ sudo su
Чтобы выйти вводим команду
    :~# exit

### Домашняя директория:
- Обычно /home/{user}
- Документы пользователя
- Настройки пользователя
- Общие настройки системы /etc
- Обозначается как ~
### Переходы по директориям:
- :~$ cd /          - переход в корневой каталог
- :~$ cd ..         - переход на уровень вверх
- :~$ cd ../..      - переход на два уровня вверх
- :~$ cd            - переход в домашнюю директорию
- :~$ cd ~          - переход в домашнюю директорию
- :~$ cd name_dir   - переход к каталогу name_dir

### Специальные файловые системы:
- /dev — устройства
- /proc — процессы и состояние ОС
    ○ /proc/cpuinfo — процессор
    ○ /proc/version — версия ОС
- /sys — информация о системе
- /run — временные файлы состояния

### Тип файлов:
Тип файла:              Обозначение (ls)      Обозначение (mc)    Описание типа
Обычный файл                    -                   нет             файл на диске
Директория                      d                   /               файл со списком элементов
Блочное устройство              b                   +               дисковый накопитель
Символьное устройство           c                   -               посимвольно (например терминал VSCode)
UNIX-сокет                      s                   =               файл 0 бит, заменяющий TSP
Именованный канал               p                   |               как сокет, но др. функционал 
Символическая ссылка            l                   @ и ~

### Работа с файлами
- ls — список файлов
    ○ ls -al        — подробный список файлов
    ○ ls --help     — справка по команде ls
    ○ man ls        — мануал для утилиты ls (более развернуто, чем --help)
- pwd — текущая директория  (выдает полный путь к директории)
- mkdir — создание каталога     (не сможет создать несколько каталогов "матрешку" (например 1/2/3/4/5 ))
    ○ mkdir -p  1/2/3/4/5    — создаст весь путь и всю "матрешку" (если таких каталогов нет) до последнего 5 каталога
- cp — копирование
    ○ cp test1 test2          — копирует файл test1 в файл test2 который создает при копировании
    ○ cp -r test test3        — копирует каталог test в каталог test3 который создает при копировании (где -r  - рекурсия)

- rm — удаление
    ○ rm -f name_file         — удаляет файл без дополнительных вопросов
    ○ rm -rf name_dir         — удаляет каталог (директорию) без дополнительных вопросов
!!! Рекомендуется прописывать полный путь к файлу или директории, которую надо удалить, т.к. команда опасная, а полный путь помогает избежать ошибок
- mv — переименование/перенос
    ○ mv test1 test4          — переименует файл test1 в test4, т.к. источник и назначение находятся в одной файловой системе
- touch — создание пустого файла
- cat — вывод файла, склейка, создание
    ○ cat name_file                     — вывод файла
    ○ cat test1 test2 > test_all        — склейка двух файлов с созданием нового файла, состоящего из первых двух (можно склеить много файлов (пишем их до угловых скобок через пробел))
    ○ cat > name_file                   — создание файла (с записью в него данных) Ctrl+D - закроет запись в файл
    ○ cat >> name_file                  — дозаписывет файл не перезаписывая его полностью. Ctrl+D - закроет запись в файл

### Относительные и абсолютные пути
- Абсолютные:
    ○ начинаются с корня /
    ○ всегда указывают на один и тот же объект
    ○ cat /var/log/syslog
    !!! Абсолютный путь всегда будет указывать на конкретный файл, даже если, например файл с абсолютной ссылкой переместить, он ксе равно будет указывать на этот файл 
- Относительные:
    ○ не начинаются c /
    ○ зависят от текущего положения
    ○ cat test/testfile
    !!! Относительный путь будет указывать на конкретный файл до тех пор, пока , например файл с относительной ссылкой не переместили в другую директорию, при перемещении относительная ссывлка сломается
### Жёсткие ссылки
Схема жесткой ссылки:
                    Имя 1-го файла в директории и Имя 2-го файла в директории <- жестакя ссылка -> Индексный дескриптор inode (метаданные)  <-> Данные на диске
- inode     — небольшая структура данных, в которой описаны метаданные про наш элемент в файловой системе (м/б каталог, файл и т.п.). Он знает все, кроме названия файла. Жесткая сслка это связь между именем файла и inode, а дальше inode ведет к данным на диске. Пока существует хотя бы одна жесткая ссылка этот inode будет рабочим.
!!! Жесткие ссылки могут работать только в одной файловой системы (в рамках одного раздела жесткого диска). 
!!! При изменении данных в одном из файлов, связанных жесткой ссылкой, изменения вносятся в оба файла, т.к. имеют один inode
!!! Не допускается создавать жесткие ссылки на каталоги
!!! Жесткие ссылки имеют применение в резервном копировании
!!! При жесткой ссылке реально не создается несколько файлов, а имеется один и тот же inode с несколькими названиями
    Пример: 
            - :~$ ln file1 file_ln     — создает жёсткую ссылку file_ln на file1 (у обоих файлов одна и та же ссылка на один inode)
            - :~$ ln -ali              — посмотреть информацию об inode (номер в первом столбце - inode)
### Символические ссылки
Схема символической ссылки:
 Имя 1-ой символической ссылки и Имя 2-ой символической ссылки <- символическая ссылка -> Имя файла или директории (абсолютный или относительный путь) <-> Индексный дескриптор inode (метаданные)  <-> Данные на диске
!!! Символическая ссылка это отдельный тип файла (буква l (в ls))
!!! Символическая ссылка ссылается не на inode, а на имя другого файла или каталога
!!! Символические ссылки можно делать и на файлы и на каталоги
!!! Символические ссылки можно делать как в пределах одной файловой системы, так и за ее пределами - никаких ограничений нет!
!!! Но - каждая символическая ссылка будет занимать собственный inode 
!!! Символическая ссылка - это файл в котором прописан путь
    Пример: 
            - :~$ ln -s file1 file_lns      — создает символическую ссылку file_lns на file1 
            - :~$ ln -ali                   — посмотреть информацию об inode (номер в первом столбце - inode)
!!! При внесении изменения в файл file_lns (cat >> file_lns) с ним ничего не произойдет, а изменения появятся в файле file1

## Текстовые редакторы

### Текстовый редактор Vim
- Командный режим (Esc)
    ✖ навигация по файлу
    ✖ копирование и вставка
    ✖ удаление символов и строк
    ✖ поиск текста
- Режим редактирования (I, A, O, Insert)
    ✖ ввод и редактирование текста
    как в обычных редакторах
- Режим последней строки (: (двоеточие))
    ✖ сохранение файла (w)
    ✖ выход из редактора (q)
    ✖ изменение настроек (set)

### Текстовый редактор Nano
    ● Cправка — Ctrl+G
    ● Сохранение файла — Ctrl+O
    ● Выход — Ctrl+X
    ● Включение номеров строк — Alt+N
    ● Поиск — Ctrl+W

### Текстовый редактор Mcedit
    ● Cправка — F1
    ● Сохранение файла — F2
    ● Выход — F10 или Esc+Esc
    ● Включение номеров строк — Alt+N
    ● Поиск — F7
    ● Выделение блока — F3
    ● Меню — F9
    ● Копировать в файл — Ctrl+F
    ● Вставить файл — Shift+F5

### Терминальные пейджеры less и more
- less
    ✖ прокрутка: PgUp, PgDown, курсор
    ✖ поиск: / и ?
    ✖ справка: H
- more
    ✖ прокрутка: Enter, пробел
    ✖ поиск: / и ?
    ✖ справка: H

### head и tail
- head — начало файла
    Пример: 
        :~$ head -n 10 .profile     (посмотреть файл .profile первые 10 строк)
- tail — конец файла
    Пример: 
        :~$ tail -n 10 .profile     (посмотреть файл .profile последние 10 строк)
        :~$ tail -f .profile        (позволяет отслеживать изменения файл .profile)

## Урок 3. Права доступа и пользователи

### Классификация пользователей в Linux
- Суперпользователь (root)
    ● UID = 0
    ● Home /root
    ● Пароль не всегда
    ● Есть shell
    ● Неограниченные полномочия
- Обычный пользователь (user)
    ● UID > 1000
    ● Home /home/user
    ● Пароль установлен
    ● Есть shell
    ● Доступ в рамках домашней директории
- Системный пользователь (daemon)
    ● 1 < UID < 1000
    ● Home Любая
    ● Пароля нет
    ● Нет shell
    ● Ограниченный доступ

### Атрибуты пользователя в Ubuntu
● UID – user ID                 ● 1000
● GID – group ID                ● 1000
● Домашняя директория (home)    ● /home/{user}
● Логин (login)                 ● {user}
● Пароль (password)             ● *****
● Оболочка (shell)              ● /bin/bash

### Некоторые команды:
- id                            - показывает где мы находимся, какой пользователь,  какая группа и какие группы есть вообще
- sudo id t_user                - то же что и id, только для другого пользователя
- cat /etc/passwd               - просмотр перечня пользователей, подключенных к системе
- sudo cat /...                 - если отказано в доступе, можно попробовать через sudo (может запросить пароль)

### Хранение данных о пользователях:
- /etc/passwd – список пользователей
- /etc/group – группы пользователей
- /etc/shadow – пароли пользователей

### Управление пользователями:
- useradd – создание пользователя
    Пример:  
        :~$ sudo useradd -s /bin/bash -m -d /home/testuser t_user (где: -s /bin/bash (параметр shell (оболочка)), -m (домашняя директория), -d /home/testuser (точный путь для домашней директории), t_user (логин пользователя))
- adduser – создание пользователя (скрипт)
    Пример: 
        :~$ sudo adduser t_user2 (где: t_user2 (логин пользователя)) - при запуске скрипт сразу создаст все параметры и даже попросит установить пароль для пользователя
- usermod – изменение пользователя (например поместить его в дополнительную группу, поменять его основную группу и т.д.)
    Пример: 
        :~$ sudo usermod -aG adm t_user     (где -a (append (добавитель)), G (список дополнительных групп), adm (название группы), t_user (пользователь)) - если пользователь активен в тот момент когда его добавили в группу, то добавление произойдет после его выхода из текущей сессии
    Пример: 
        :~$ sudo usermod -g www-data t_user (где -g (изменение основной группы),  www-data (название группы), t_user (пользователь))
    Другие изменение можно посмотреть в мануале :~$ man usermod
- userdel – удаление пользователя
    Пример: 
        :~$ sudo userdel t_user2    (удалит пользователя, но не удалит домашнюю директорию, для удаления директории нужно указать параметр -r)
- passwd – изменение пароля
    Пример: 
        :~$ sudo passwd t_user
- chage – изменение свойств пароля
    Пример: 
        :~$ sudo chage t_user
- groupadd – создание группы
    Пример: 
        :~$ sudo groupadd testgroup
    !!! посмотреть перечень групп можно в в файле /etc/group        
        Пример: 
            :~$ cat /etc/group
- groupdel – удаление группы
    Пример: 
        :~$ sudo groupdel testgroup
- Если мы захотим запретить пользователю доступ, то перед паролем в  /etc/shadow необходимо поставить восклицательный знак'!'
- Для возврата доступа пользователю - восклицательный знак удаляется, пароль остается тем же

### Механизм sudo и su:
- su – переключение пользователя
- sudo su – переключение на суперпользователя (root)
- sudo – выполнение команды с правами суперпользователя
- /etc/sudoers – конфигурация sudo
- visudo – редактирование       (файла /etc/sudoers.tmp для внесения изменений в права root, admin, sudo и т.п.)
    ● root    ALL=(ALL:ALL) ALL     (в файле sudoers суперпользователь root имеет максимальный допуск ко всему (судя по формуле))
    ● %admin ALL=(ALL) ALL          (группа admin (% - обозначает группу) )
    ● %sudo   ALL=(ALL:ALL) ALL     (группа sudo имеет максимальный допуск ко всему (судя по формуле))
    Формула ALL=(ALL:ALL) ALL означает что можно исполнять команды с использованием любого пользователя, с любой группой и набор комманд не ограничен (последняя ALL)
    Если необходимо выдать права на какие-то конкретные команд, то вместо ALL прописываются разрешения
        Например:
            %admin ALL=(ALL) /user/bin/passwd       (такой пользователь сможет менять пароль кому угодно, но больше ничего не сможет)
            %admin ALL=(ALL) NOPASSWD:ALL           (такая команда отменит введение паролей у данной группы)
        Прописав группу в файле sudoers и обозначив права для этой группы, мы потом в нее добавляем пользователь для выдачи им этих прав

### Изменение владельца и группы владельца файлов:
- chown – изменение владельца и группы          !!! опасная команда, т.к. может повлечь за собой много проблем, особенно Рекурсия
    ○ chown -R – рекурсивно             (замена владельца во всей директории (каталоге))
        Пример: :~$ sudo chown -R t_user:www-data /home/olga/test3     (команду пишем в нужной директории)
    ○ chown testuser:testgroup          (замена владельца и группы для конкретного файла в директории)
        Пример: :~$ sudo chown t_user:www-data test     (команду пишем в нужной директории)
    ○ chown testuser                    (замена владельца для конкретного файла)
- chgrp – изменение группы
    ○ chgrp -R –рекурсивно
        Пример: :~$ sudo chgrp -R adm /home/olga/test3
    ○ chgrp testgroup

### Права доступа для файлов и директорий:
!!!  r - чтение, w - запись, x - исполнение
!!!  x - исполнение ставится только у директорий, у файлов бит на исполнение не ставится!!!
- rwx   - владелец (совпадение пользователя)
- r-x   - группа (пользователь в группе)
- r--   - остальные (все остальные пользователи)
-При числовой форме записи: 4 - бит чтения (4 = r), 2 - бит записи (2 = w), 1 - бит исполнения (1 = x) 
    ○ 7 = 4+2+1 = rwx
    ○ 6 = 4+2   = rw-
    ○ 5 = 4+1   = r-x 

### Специальные биты
!!! Специальные биты применяются для узко-специальных задач 
- SUID          - (бит, который выставляет user id (UID) при выполнении файла)
    4000        - (обозначение в восьмеричной форме)
    ✖ для исполняемых файлов
    ✖ запуск программы от имени владельца файла
    -rwsr       - (если на третьем месте стоит s, значит выставлен бит SUID. Если на том же месте стоит S, это значит, что SUID бит установлен, но нет бита на исполнение, т.е. особого смысла в этом нет, т.к. файл не исполняемый для владельца)
        Пример: sudo chmod u+s neme_file        (выставление спец бита (SUID))
    !!! Этот бит (SUID), запускает файл не с правами Вашего пользователя, а с правами владельца файла (в основном это используется для запуска программы от root, при этом Вы можете быть обычным пользователем, не иметь никаких прав для sudo, но программа запустится с правами root (например при смене пароля, у себя, у всех пользователей права root))
- SGID          - (предназначен для директорий и позволяет создавать файлы, у которых группа будет назначена от группы этого каталога)
    2000
    ✖ для директорий
    ✖ создание файлов с группой, назначенной для директории
    -sr
        Пример: sudo chmod g+s neme_dir         (выставление спец бита (SGID))
- Sticky bit    - (позволяет для директорий разрешить удаление файлов только для создателей этого файла, либо для владельцев этой директории)
    1000
    ✖ для директорий
    ✖ удаление файлов только владельцем файла или директории
    -t
    !!! Применимо там, где широкие права доступа для каталога и чтобы один пользователь не смог удалять файлы другого пользователя

### Изменение прав доступа:
- chmod — change mode, изменение прав доступа       !!! опасная команда т.к. может повлечь за собой неработоспособность какого-то компонента, особенно Рекурсия
    ○ chmod -R testdir/ – рекурсивно                        (изменение прав доступа ко всем файлам во всей директории (каталоге))
        Пример: sudo chmod -R o=rx test3/               (права доступа для всех файлов в директории test3/ стали для остальных r-x)
    ○ chmod u=rwx,g=rx,o=r testfile – символьная форма      (формат символьной записи прав доступа где u - владелец, g  - группа, o - остальные)
        Пример: sudo chmod u=rwx,g=rw,o=rx test2        (права доступа: -rwxrw-r-x)
                sudo chmod u+rwx,g=rw,o-rx test2        (права доступа: -rwxrw----)
    ○ chmod 751 testfile – числовая форма                   (где 7 - права доступа для владельца (7=rwx), 5 - права доступа для группы, 1 - для остальных)
            Пример: sudo chmod 664 test2                (права доступа: -rw-rw-r--)
    ○ chmod a+x – изменение для всех                        (chmod a+x -способ указать биты для всех, либо просто chmod +x -это добавит бит на исполнение для всех трех групп (для владельца, для группы и для остальных))
    ○ chmod 4755 – изменение специальных битов      (где: 4 -SUID бит, 755 - обычные основные биты)

### Права по умолчанию и umask:
    Назначение:             Файлы:      Директории:
    Полные права            666         777
    Значение umask          022         022         (umask - это понижение прав доступа)
    Права по умолчанию      644         755         (получаем путем вычитания каждого бита (из полных прав вычитаем umask))
!!! Значение umask
    Пример:
        :~$ umask 
        :~/name_dir$ umask 002       (установить значение umask для конкретной директории)
        :~/$ umask 022               (установить значение umask для все домашней директории)  

