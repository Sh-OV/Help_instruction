# ИНСТРУКЦИЯ по работе с LINUX

## Основы Linux

### Системные вызовы в Linux
1. Управление процессами:
    - fork() – создание нового процесса клонированием
    - exec() – запуск программы
    - exit() – завершение программы
2. Управление файлами:
    - open() – открыть файл
    - read() – прочитать данные из файла
    - write() – записать данные в файл
    - close() – закрыть файл

### Установка пакетов в Ubuntu
- sudo apt update – обновить список пакетов
- sudo apt install mc – установить пакет mc
- sudo apt install openssh-server – установить SSH-сервер

### Сетевые режимы VirtualBox
- Мост (bridge) – ВМ в локальной сети, прямой доступ к ВМ по IP.
- NAT – ВМ в своей сети, доступ к машине только через проброс портов.
        При пробросе портов (создаем порт, протокол - TCP, Порт хоста - 8022, Порт гостя - 22)

### Установка гостевых дополнений VB в Ubuntu
- sudo apt update – обновить список пакетов
- sudo apt install perl gcc make – установить пакеты
- Запуск установки гостевых дополнений

### Команды для подключения сети:
- ip a      - покажет список сетевых интерфейсов
- systemctl status ssh          - проверяем статус сервисов (подключения)
- ssh olga@192.168.0.108        - подключение (по мосту (bridge) к удаленному   пользователю, в нашем случае к Windows PowerShell)
- ssh -p 8022 olga@localhost    - подключение NAT (при беспроводном интернете) с помощью проброса портов

## Работа с файлами в терминале

### Что такое оболочка
Пользователь    ->  Оболочка (Bash) ->  Операционная система
Оболочка - посредник (переводчик) между пользователем и операционной системой

### Приглашение оболочки Bash
Пример записи:  olga@olga-VirtualBox-linux:~$
Расшифровка:    "имя пользователя(логин)"(olga) @ "имя компьютера(хоста)"(olga-VirtualBox-linux) : "текущий каталог"(~ (домашний католог)) "тип пользователя"($ (обычный пользователь))
    $   - обычный пользователь
    #   - суперпользователь с правами root
Чтобы подключиться с правами суперпользователя вводим команду
    :~$ sudo su
Чтобы выйти вводим команду
    :~# exit

### Домашняя директория:
- Обычно /home/{user}
- Документы пользователя
- Настройки пользователя
- Общие настройки системы /etc
- Обозначается как ~
### Переходы по директориям:
- :~$ cd /          - переход в корневой каталог
- :~$ cd ..         - переход на уровень вверх
- :~$ cd ../..      - переход на два уровня вверх
- :~$ cd            - переход в домашнюю директорию
- :~$ cd ~          - переход в домашнюю директорию
- :~$ cd name_dir   - переход к каталогу name_dir

### Специальные файловые системы:
- /dev — устройства
- /proc — процессы и состояние ОС
    ○ /proc/cpuinfo — процессор
    ○ /proc/version — версия ОС
- /sys — информация о системе
- /run — временные файлы состояния

### Тип файлов:
Тип файла:              Обозначение (ls)      Обозначение (mc)    Описание типа
Обычный файл                    -                   нет             файл на диске
Директория                      d                   /               файл со списком элементов
Блочное устройство              b                   +               дисковый накопитель
Символьное устройство           c                   -               посимвольно (например терминал VSCode)
UNIX-сокет                      s                   =               файл 0 бит, заменяющий TSP
Именованный канал               p                   |               как сокет, но др. функционал 
Символическая ссылка            l                   @ и ~

Тип Обозначение (ls) Обозначение (mc)
Обычный файл – нет
Директория d /
Блочное устройство b +
Символьное устройство c –
UNIX-сокет s =
Именованный канал p |
Символическая ссылка l @ и ~ 
### Работа с файлами
- ls — список файлов
    ○ ls -al        — подробный список файлов
    ○ ls --help     — справка по команде ls
    ○ man ls        — мануал для утилиты ls (более развернуто, чем --help)
- pwd — текущая директория  (выдает полный путь к директории)
- mkdir — создание каталога     (не сможет создать несколько каталогов "матрешку" (например 1/2/3/4/5 ))
    ○ mkdir -p  1/2/3/4/5    — создаст весь путь и всю "матрешку" (если таких каталогов нет) до последнего 5 каталога
- cp — копирование
    ○ cp test1 test2          — копирует файл test1 в файл test2 который создает при копировании
    ○ cp -r test test3        — копирует каталог test в каталог test3 который создает при копировании (где -r  - рекурсия)

- rm — удаление
    ○ rm -f name_file         — удаляет файл без дополнительных вопросов
    ○ rm -rf name_dir         — удаляет каталог (директорию) без дополнительных вопросов
!!! Рекомендуется прописывать полный путь к файлу или директории, которую надо удалить, т.к. команда опасная, а полный путь помогает избежать ошибок
- mv — переименование/перенос
    ○ mv test1 test4          — переименует файл test1 в test4, т.к. источник и назначение находятся в одной файловой системе
- touch — создание пустого файла
- cat — вывод файла, склейка, создание
    ○ cat name_file                     — вывод файла
    ○ cat test1 test2 > test_all        — склейка двух файлов с созданием нового файла, состоящего из первых двух (можно склеить много файлов (пишем их до угловых скобок через пробел))
    ○ cat > name_file                   — создание файла (с записью в него данных) Ctrl+D - закроет запись в файл
    ○ cat >> name_file                  — дозаписывет файл не перезаписывая его полностью. Ctrl+D - закроет запись в файл

### Относительные и абсолютные пути
- Абсолютные:
    ○ начинаются с корня /
    ○ всегда указывают на один и тот же объект
    ○ cat /var/log/syslog
- Относительные:
    ○ не начинаются c /
    ○ зависят от текущего положения
    ○ cat test/testfile
### Жёсткие ссылки
Схема жесткой ссылки:
                    Имя файла в директории <-> Индексный дескриптор inode (метаданные)  <-> Данные на диске
- inode     — небольшая структура данных, в которой описаны метаданные про наш элемент в файловой системе (м/б каталог, файл и т.п.). Он знает все, кроме названия файла. Жесткая сслка это связь между именем файла и inode, а дальше inode ведет к данным на диске. Пока существует хотя бы одна жесткая ссылка этот inode будет рабочим.
    Пример: 
- :~$ ln file1 file4       — создает жёсткую ссылку file4 на file1 (у обоих файлов одна и та же ссылка на один inode)
- :~$ ln -ali              — посмотреть информацию об inode (номер в первом столбце - inode)
!!! Жесткие ссылки могут работать только в одной файловой системы (в рамках одного раздела жесткого диска). 
!!! При изменении данных в одном из файлов, связанных жесткой ссылкой, изменения вносятся в оба файла, т.к. имеют один inode
### Символические ссылки
 Имя символической ссылки <-> Имя файла или директории (абсолютный или относительный путь) <-> Индексный дескриптор inode (метаданные)  <-> Данные на диске

### Общие команды:
- id                            - показывает где мы находимся, какой пользователь,  какая группа и какие группы есть вообще
- sudo id t_user                - то же что и id, только для другого пользователя
- cat /etc/passwd               - просмотр перечня пользователей, подключенных к системе
- sudo cat /...                 - если отказано в доступе, можно попробовать через sudo (может запросить пароль)
### Хранение данных о пользователях:
- /etc/passwd – список пользователей
- /etc/group – группы пользователей
- /etc/shadow – пароли пользователей
### Управление пользователями:
- useradd – создание пользователя
    Пример:  :~$ sudo useradd -s /bin/bash -m -d /home/testuser t_user (где: -s /bin/bash (параметр shell (оболочка)), -m (домашняя директория), -d /home/testuser (точный путь для домашней директории), t_user (логин пользователя))
- adduser – создание пользователя (скрипт)
    Пример: :~$ sudo adduser t_user2 (где: t_user2 (логин пользователя)) - при запуске скрипт сразу создаст все параметры и даже попросит установить пароль для пользователя
- usermod – изменение пользователя (например поместить его в дополнительную группу, поменять его основную группу и т.д.)
    Пример: :~$ sudo usermod -aG adm t_user     (где -a (append (добавитель)), G (список дополнительных групп), adm (название группы), t_user (пользователь)) - если пользователь активен в тот момент когда его добавили в группу, то добавление произойдет после его выхода из текущей сессии
    Пример: :~$ sudo usermod -g www-data t_user (где -g (изменение основной группы),  www-data (название группы), t_user (пользователь))
    Другие изменение можно посмотреть в мануале :~$ man usermod
- userdel – удаление пользователя
    Пример: :~$ sudo userdel t_user2    (удалит пользователя, но не удалит домашнюю директорию, для удаления директории нужно указать параметр -r)
- passwd – изменение пароля
    Пример: :~$ sudo passwd t_user
- chage – изменение свойств пароля
    Пример: :~$ sudo chage t_user
- groupadd – создание группы
    Пример: :~$ sudo groupadd testgroup
- groupdel – удаление группы
    Пример: :~$ sudo groupdel testgroup
- Если мы захотим запретить пользователю доступ, то перед паролем в  /etc/shadow необходимо поставить восклицательный знак'!'
- Для возврата доступа пользователю - восклицательный знак удаляется, пароль остается тем же
### Механизм sudo и su:
- su – переключение пользователя
- sudo su – переключение на
суперпользователя (root)
- sudo – выполнение команды с правами
суперпользователя
- /etc/sudoers – конфигурация sudo
- visudo – редактирование
### Изменение владельца и группы владельца файлов:
- chown – изменение владельца и группы
    ○ chown -R – рекурсивно             (замена владельца во всей директории (каталоге))
        Пример: :~$ sudo chown -R t_user:www-data /home/olga/test3     (команду пишем в нужной директории)
    ○ chown testuser:testgroup          (замена владельца и группы для конкретного файла в директории)
        Пример: :~$ sudo chown t_user:www-data test     (команду пишем в нужной директории)
    ○ chown testuser                    (замена владельца для конкретного файла)
- chgrp – изменение группы
    ○ chgrp -R –рекурсивно
        Пример: :~$ sudo chgrp -R adm /home/olga/test3
    ○ chgrp testgroup
### Права доступа для файлов и директорий:
    r - чтение, w - запись, x - исполнение
- rwx   - владелец (совпадение пользователя)
- r-x   - группа (пользователь в группе)
- r--   - остальные (все остальные пользователи)
### Изменение прав доступа:
- chmod — change mode, изменение прав доступа
    ○ chmod -R testdir/ – рекурсивно
    ○ chmod u=rwx,g=rx,o=r testfile – символьная форма
    ○ chmod 751 testfile – числовая форма
    ○ chmod a+x – изменение для всех
    ○ chmod 4755 – изменение специальных битов
### Права по умолчанию и umask:
    Назначение:             Файлы:      Директории:
    Полные права            666         777
    Значение umask          022         022
    Права по умолчанию      644         755

